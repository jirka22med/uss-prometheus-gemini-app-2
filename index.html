<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USS PROMETHEUS | Tactical Operations v5.8</title>
     <link rel="icon" href="https://img41.rajce.idnes.cz/d4102/19/19244/19244630_db82ad174937335b1a151341387b7af2/images/image_300x3001_2.jpg?ver=1" type="image/png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="multi-file-styles.css">
    <link rel="stylesheet" href=" hlasovi-model-moldar.css">
    <link rel="stylesheet" href="Multimedialni-velikosti-vsech-obrazovek.css"> 
    <link rel="stylesheet" href="serpapi-search--vyhledavac-by-vice-admiral-jirik.css">
    <link rel="stylesheet" href="style-uss-prometheus.css">
    
    
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@1.38.0",
        "react": "https://esm.sh/react@^19.2.3",
        "react/": "https://esm.sh/react@^19.2.3/"
      }
    }
    </script>
</head>
<body class="prometheus-body">
    <div id="app" class="app-container">
        
        <!-- MODUL: CHAT SIDEBAR -->
        <div id="chat-sidebar" class="chat-sidebar">
            <header class="tactical-header"   >
                <div class="ship-id">
                    <div class=""></div>
                    <h1 class="header-title" id="nazev-prehravace" style="background:#000;"> USS PROMETHEUS</h1>
                        <p>Tactical Command Center v5.8</p>
                    <div> 
                        </div>
                </div>
                <div class="header-controls">
                    <button id="manual-canvas-btn" class="btn-iconic" title="Taktick√° obrazovka">
                        <span>üñ•Ô∏è Taktik</span>
                    </button>

                    <button id="relink-api-btn" class="btn-iconic status-btn" title="Kalibrace">
                        <div id="api-status-dot" class="status-dot alert"></div>
                        <span>Rekalibrovat</span>
                    </button>
                    
                    <button id="voice-toggle" class="btn-iconic">
                        <div id="voice-indicator" class="status-dot"></div>
                        <span>Audio</span>
                    </button>
                    
                     
                   <!-- <button id="jirik-manual-opener-btn" >üßæ</button> -->
                   <!-- <button id="debug-manager-button">üõ†Ô∏è DIAGNOSTIKA</button> -->
                    <button id="fullscreen-toggle" title="Cel√° obrazovka (F)" style="font-size: 5px; border-radius: 0px;"    >‚õ∂</button>
                     <button id="prev-button" title="P≈ôedchoz√≠ (≈†ipka vlevo)" style="font-size: 5px; border-radius: 0px;"  >‚óÄÔ∏è‚¨ÖÔ∏è</button>
<button id="play-button" title="P≈ôehr√°t (Mezern√≠k/P)" style="font-size: 5px; border-radius: 0px;"   >üöÄ</button>
<button id="pause-button" title="Pauza (Mezern√≠k/P)" style="font-size: 5px; border-radius: 0px;" > ‚è∏Ô∏è</button>
<button id="next-button" title="Dal≈°√≠ (≈†ipka vpravo)" style="font-size: 5px; border-radius: 0px;" >‚ñ∂Ô∏è‚û°Ô∏è</button>
                    <button id="open-search-btn" class="btn-iconic" title="Tactical Search">SEARCH</button>
                    <select id="model-selector" class="bridge-select">
                        <option value="gemini-3-flash-preview">gemini-3 flash</option>
                        <option value="gemini-2.5-flash">gemini-2.5-flash</option>
                    </select>
                </div> 
                
                  <audio id="audioPlayer" style="display: none;">
    <source id="audioSource" src="" type="audio/mpeg" style="display: none;">
</audio>

                 
                 
              
 
            
                 
                <div class="time-controls" id="progres-bar-time-part" style="display: none" >
        <span id="currentTime" style="display:inline-block;padding:2px;background:#000;border:2px solid #C00000;color:#fff;margin:0;">
         <span class="time-part" style="color: white;">00</span><span class="time-separator" style="color: white;">:</span><span class="time-part" style="color: white;">00</span><span class="time-separator" style="color: white;">:</span><span class="time-part" style="color: white;">00</span>
        </span>
        <input type="range" id="progress-bar" min="0" max="100" value="0" style="display:inline-block;padding:2px;background:#000;border:2px solid #C00000;color:#fff;margin:0;">
        <span id="duration" style="display:inline-block;padding:2px;background:#000;border:2px solid #C00000;color:#fff;margin:0;">
          <span class="time-part" style="color: white;">00</span><span class="time-separator" style="color: white;">:</span><span class="time-part" style="color: white;">00</span><span class="time-separator" style="color: white;">:</span><span class="time-part" style="color: white;">00</span>
        </span>
      </div>
            </header>
   

            <div id="chat-messages" class="message-display">
                <div class="initial-scan" >
                    [ STATUS: SCANNING SHIP SYSTEMS... ]
                </div>
            </div>

            <!-- ‚úÖ ROZ≈†√ç≈òEN√ù FILE PREVIEW - MULTIPLE FILES -->
            <div id="file-preview-container" class="file-preview-multi hidden">
                <div class="file-preview-header">
                    <span id="file-count-display">0 SOUBOR≈Æ</span>
                    <button id="clear-all-files-btn" class="btn-clear-all">VYMAZAT V≈†E</button>
                </div>
                <div id="file-preview-list" class="file-preview-grid"></div>
            </div>

            <div class="ship-stats" id="system-info-status">
                 <div class="performance-mode" id="perfMode">‚ö° VARIANTA B</div>
                <div  class="status-dot alert-1" id="dioda 1"></div>
                <div class="stat-item" id="CORE"><span>CORE:</span> <span id="stat-core" class="emerald">100%</span></div>
                <div class="status-dot alert-2" id="dioda 2"></div>
                <div class="stat-item" id="SHIELDS"><span>SHIELDS:</span> <span id="stat-shields" class="indigo">98%</span></div>
                <div class="status-dot alert-3" id="dioda 3"></div>
                <div class="stat-item" id="SIGNAL"><span>SIGNAL:</span> <span id="stat-signal" class="amber">OPTIMAL</span></div>
                <div class="status-dot alert-4" id="dioda 4"></div>
                <h2 id="trackTitle" style="display: none; font-size: 12px;" >Vyberte skladbu</h2>
            </div>
                                                    
            
            <div class="zprava-vice-admiral-jirik" >
            <footer class="input-area">
    <form id="chat-form" class="bridge-form">
        <!-- ‚úÖ MULTIPLE FILE INPUT - ROZ≈†√ç≈òEN√â TYPY -->
        <input type="file" id="file-input" class="hidden" accept="image/*,video/*,audio/*,.pdf,.txt,.js,.py,.html,.json,.css,.md,.mp3,.wav,.mp4,.avi,.docx,.doc,.xlsx,.xls,.pptx,.ppt,.xml,.csv,.zip,.rar,.7z,.tar,.gz,.java,.cpp,.c,.php,.rb,.sh,.bash" multiple>
        <button type="button" id="attach-btn" class="btn-attach" title="P≈ôilo≈æit soubory (max 10)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" /></svg>
        </button>
        <input type="text" id="chat-input" placeholder="Zadejte strategick√Ω rozkaz..." class="input-bridge" autocomplete="off">
        <button type="submit" id="send-btn" class="btn-vyslat">Vyslat</button>
    </form>
</footer>
        </div>
 </div>
        <!-- CANVAS PANEL -->
        <div id="canvas-panel" class="canvas-panel hidden">
            <header class="canvas-header">
                <div class="canvas-status">
                    <div class="ping-dot" id="canvas-stavova-dioa"></div>
                    <span id="canvas-title">Canvas</span>
                </div>
                <div class="canvas-actions">
                    <div class="view-tabs">
                        <button id="view-code-btn" class="tab-btn active">K√ìD</button>
                        <button id="view-preview-btn" class="tab-btn">N√ÅHLED</button>
                    </div>
                    
                    <div class="action-group">
                        <button id="edit-canvas-btn" class="btn-action">UPRAVIT</button>
                        <button id="save-canvas-btn" class="btn-action btn-save hidden">ULO≈ΩIT</button>
                        <button id="ai-assist-btn" class="btn-action btn-ai">ASIS</button>
                    </div>
                    
                    <button id="close-canvas-btn" class="btn-exit">Zav≈ô√≠t</button>
                </div>
            </header>
            <div id="canvas-container" class="canvas-body scanning">
                <textarea id="canvas-editor" readonly class="code-editor" spellcheck="false"></textarea>
                <div id="canvas-preview" class="hidden preview-frame"></div>
            </div>
        </div>
    </div>

    <!-- MOD√ÅLY -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- üîß KALIBRACE API MODAL - ENHANCED WITH PASSWORD MASKING -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div id="calibration-modal" class="modal-overlay hidden">
    <div class="modal-content calibration-modal">
        <header class="modal-header">
            <h2>üîß Kalibrace J√°dra API</h2>
            <button id="close-calibration">‚úï</button>
        </header>
        <div class="modal-body">
            <p class="mono-msg">> MANU√ÅLN√ç AUTORIZACE PROTOKOLU...</p>
            
            <!-- GEMINI API KEY -->
            <div class="input-group">
                <label style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span>ü§ñ GEMINI API KL√çƒå:</span>
                    <button id="toggle-gemini-visibility" class="btn-toggle-visibility">
                        <span id="gemini-eye-icon">üëÅÔ∏è</span> Zobrazit
                    </button>
                </label>
                <input 
                    type="password" 
                    id="manual-api-key-input" 
                    placeholder="AIzaSy..."
                    autocomplete="off"
                    style="width: 100%;"
                >
            </div>
            
            <!-- SERPAPI KEY -->
            <div class="input-group">
                <label style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span>üîç SERPAPI KL√çƒå:</span>
                    <button id="toggle-serpapi-visibility" class="btn-toggle-visibility">
                        <span id="serpapi-eye-icon">üëÅÔ∏è</span> Zobrazit
                    </button>
                </label>
                <input 
                    type="password" 
                    id="serpapi-key-input" 
                    placeholder="v√°≈°_serpapi_kl√≠ƒç"
                    autocomplete="off"
                    style="width: 100%;"
                >
                <small style="color: var(--slate-text); font-size: 9px; margin-top: 0.3rem; display: block; font-family: 'Fira Code', monospace;">
                    üí° Najde≈° na https://serpapi.com/manage-api-key
                </small>
            </div>
            
            <!-- TLAƒå√çTKA -->
            <button id="save-manual-key-btn" class="btn-primary">
                üíæ Ulo≈æit Konfiguraci
            </button>
            
            <!-- STATUS PANEL -->
            <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-main);">
                <p style="font-size: 10px; color: var(--slate-text); margin-bottom: 0.8rem; font-family: 'Orbitron', sans-serif; letter-spacing: 0.1em;">
                    üìä AKTU√ÅLN√ç STAV SYST√âMU:
                </p>
                <div id="config-status" style="font-family: 'Fira Code', monospace; font-size: 10px; display: flex; flex-direction: column; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Gemini API:</span>
                        <span id="gemini-status" class="red">‚ùå Nenastaveno</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>SerpAPI:</span>
                        <span id="serpapi-status" class="red">‚ùå Nenastaveno</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* ‚úÖ TOGGLE VISIBILITY BUTTON */
.btn-toggle-visibility {
    padding: 0.2rem 0.5rem;
    background: var(--bg-surface);
    border: 1px solid var(--border-main);
    border-radius: 4px;
    color: var(--slate-text);
    font-family: 'Fira Code', monospace;
    font-size: 9px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.btn-toggle-visibility:hover {
    border-color: var(--indigo-primary);
    color: var(--indigo-primary);
}

.btn-toggle-visibility:active {
    transform: scale(0.95);
}
</style>

    <div id="ai-assistant-modal" class="modal-overlay hidden">
        <div class="modal-content ai-modal">
            <header class="modal-header">
                <h2>AI ASISTENT</h2>
                <button id="close-ai-modal">‚úï</button>
            </header>
            <div class="modal-body">
                <div id="current-code-preview" class="code-box"></div>
                <textarea id="ai-instructions-input" placeholder="Instrukce pro AI..."></textarea>
                <div class="modal-footer">
                    <button id="cancel-ai-btn">Zru≈°it</button>
                    <button id="send-to-ai-btn" class="btn-primary">ü§ñ Upravit</button>
                </div>
            </div>
        </div>
    </div>
     
    <!-- üîç SERPAPI VYHLED√ÅVAƒå - TACTICAL SEARCH MODULE -->
<div id="serpapi-search-panel" class="search-panel hidden">
    <header class="search-header">
        <div class="search-title">
            <div class="ping-dot"></div>
            <span>üîç TACTICAL SEARCH</span>
        </div>
        <button id="close-search-btn" class="btn-exit">Zav≈ô√≠t</button>
    </header>
   
    <div class="search-body">
        <form id="serpapi-search-form" class="search-form">
            <input 
                type="text" 
                id="search-query-input" 
                placeholder="Zadej vyhled√°vac√≠ dotaz..."
                class="search-input"
                autocomplete="off"
            >
            <button type="submit" class="btn-search">
                üîç SKENOVAT
            </button>
        </form>
        
        <div id="search-status" class="search-status hidden">
            <div class="scanning-indicator"></div>
            <span>SKENOV√ÅN√ç DATAB√ÅZ√ç...</span>
        </div>
        
        <div id="search-results-container" class="results-container">
            <!-- V√Ωsledky se vlo≈æ√≠ dynamicky -->
        </div>
    </div>
</div>
      <!-- STAR TREK HUDEBN√ç P≈òEHRAVAƒå KONFIGURACE KOMPATIBILN√ç Z USS-PROMETHEUS -->
              <script src="fleet-register.js"></script>
             
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <!--   <script src="DebugManager.js"></script>  -->  <!-- PROZAT√çM OFFLINE -->
    <script type="module" src="uss-prometheus-Firebase-Functions.js"></script> <!-- ORIGIN√ÅL NAME: audioFirebaseFunctions.js  1 -->
    <script src="buttonVisibilityFirebase.js"></script>  <!-- POS√çL√Å INFORMACE DO MODULU: uss-prometheus-Firebase-Functions.js 2 -->
    <script type="module" src="script-.js"></script>  <!-- INCILIZACE ZE STAR TREK HUDEBN√çHO P≈òEHRAVAƒåE PRO MODUL: 1 A 2 -->
    <script src="buttonVisibilityManager.js" defer></script>  <!-- MANAGER pro Ui tlaƒç√≠tka zobrazovaƒç a skr√≠vaƒç -->
    <script src="notificationFix.js" defer></script> <!-- notifikaƒçn√≠ syst√©m -->
    <script src="myPlaylist.js"></script>
  <!--  <script src="universalni-perfomens-monitor.js"></script>  <!-- doplnƒõn p≈ôed 2 minutama -->
    
    <!-- USS-PROMETHEUS -->
   <!-- <script src="jirkuv-hlidac.js" async></script> -->
    <script type="module" src="serpapi-search.js"></script>
    <script type="module" src="serpapi-search--vyhledavac-by-vice-admiral-jirik.js"></script> 
    <script type="module" src="system-prompt.js"></script>
    <script type="module" src="gemini-api.js"></script>
    <script type="module" src="canvas-editor.js"></script>
    <script type="module" src="google-cloud-tts.js"></script>
    <script type="module" src="script.js"></script>
    <script type="module" src="devtools-prometheus.js"></script>
      
 <script>                              
(function() {
const __INDEX_HTML_START = performance.now();
 
    const WATCHDOG_KEY = 'watchdog_last_check';
    const RELOAD_COOLDOWN = 10000; // 10s ochrana proti loop
    
    // üõ°Ô∏è POJISTKA #1: Cooldown check
    const lastCheck = localStorage.getItem(WATCHDOG_KEY);
    if (lastCheck && (Date.now() - parseInt(lastCheck)) < RELOAD_COOLDOWN) {
        console.log("üêï [Watchdog] Cooldown aktivn√≠ - p≈ôeskakuji check.");
        return;
    }
    
    // 1. ZLIKVIDOVAT DUCHY
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
            regs.forEach(reg => reg.unregister());
        });
    }
    
    // 2. KONTROLA ƒåERSTVOSTI
    fetch('fleet-register.js?v=' + Date.now())
        .then(r => r.text())
        .then(text => {
            const match = text.match(/version:\s*"([^"]+)"/);
            if (!match) return;
            
            const serverVer = match[1];
            const browserVer = window.FLEET_CONFIG?.version || "0.0.0";
            
            console.log(`üêï [Watchdog] Server: ${serverVer} | Browser: ${browserVer}`);
            
            if (serverVer !== browserVer) {
                console.warn("‚ö†Ô∏è [Watchdog] Zastaral√° verze! Restart za 2s...");
                
                // üõ°Ô∏è POJISTKA #2: Timestamp p≈ôed reload
                localStorage.setItem(WATCHDOG_KEY, Date.now().toString());
                
                // üõ°Ô∏è POJISTKA #3: Vyƒçistit cache P≈òED reload
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }
                
                // üõ°Ô∏è POJISTKA #4: Delay + hard reload
                setTimeout(() => {
                    window.location.href = window.location.href.split('?')[0] + '?refresh=' + Date.now();
                }, 2000);
            } else {
                console.log("‚úÖ [Watchdog] Verze OK.");
                localStorage.removeItem(WATCHDOG_KEY); // Reset cooldown
            }
        })
        .catch(err => {
            console.log("üêï [Watchdog] Offline nebo chyba:", err.message);
        });

  // ‚è±Ô∏è LOG END 
 console.log(`%cüöÄ [INDEX-HTML] Naƒçteno za ${(performance.now() - __INDEX_HTML_START).toFixed(2)} ms`, 'background: #000; color: #00ff00; font-weight: bold; padding: 2px;');
})();
</script>
</body>
</html>
